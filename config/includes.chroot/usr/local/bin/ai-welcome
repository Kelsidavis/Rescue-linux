#!/bin/bash
# AI Rescue Linux Welcome Script

clear

# Theme colors (matching our dark teal/purple theme)
TEAL='\033[38;5;43m'
PURPLE='\033[38;5;141m'
BLUE='\033[38;5;75m'
GREEN='\033[38;5;114m'
YELLOW='\033[38;5;221m'
RED='\033[38;5;203m'
GRAY='\033[38;5;245m'
WHITE='\033[38;5;255m'
DIM='\033[2m'
BOLD='\033[1m'
NC='\033[0m'

# Box drawing characters
H_LINE="─"
V_LINE="│"
TL_CORNER="╭"
TR_CORNER="╮"
BL_CORNER="╰"
BR_CORNER="╯"

echo ""
echo -e "${TEAL}${BOLD}"
cat << 'BANNER'
       █████╗ ██╗    ██████╗ ███████╗███████╗ ██████╗██╗   ██╗███████╗
      ██╔══██╗██║    ██╔══██╗██╔════╝██╔════╝██╔════╝██║   ██║██╔════╝
      ███████║██║    ██████╔╝█████╗  ███████╗██║     ██║   ██║█████╗
      ██╔══██║██║    ██╔══██╗██╔══╝  ╚════██║██║     ██║   ██║██╔══╝
      ██║  ██║██║    ██║  ██║███████╗███████║╚██████╗╚██████╔╝███████╗
      ╚═╝  ╚═╝╚═╝    ╚═╝  ╚═╝╚══════╝╚══════╝ ╚═════╝ ╚═════╝ ╚══════╝
BANNER
echo -e "${NC}"
echo -e "                    ${PURPLE}Linux Recovery & Repair System${NC}"
echo ""
echo -e "${TEAL}${TL_CORNER}$(printf '%0.s─' {1..72})${TR_CORNER}${NC}"
echo ""

# Quick commands section
echo -e "${WHITE}${BOLD}  AI-Powered Commands${NC}"
echo -e "${GRAY}  ────────────────────────────────────────────────────────────────────${NC}"
echo ""
printf "  ${TEAL}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC}\n" \
       "ai-repair" "ai-diagnose" "ai-chroot"
printf "  ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC}\n" \
       "AI repair guide" "System scan" "Enter broken OS"
echo ""
printf "  ${TEAL}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC}\n" \
       "ai-grub" "ai-mount" "ai-fstab"
printf "  ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC}\n" \
       "Boot repair" "Mount disks" "Fix /etc/fstab"
echo ""
printf "  ${TEAL}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC} ${GRAY}│${NC} ${WHITE}%-16s${NC}\n" \
       "ai-recover" "ai-clone" "ai-password"
printf "  ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC} ${GRAY}│${NC} ${DIM}%-16s${NC}\n" \
       "Data recovery" "Disk imaging" "Password reset"
echo ""

# AI tools section
echo -e "${WHITE}${BOLD}  AI Assistants${NC}"
echo -e "${GRAY}  ────────────────────────────────────────────────────────────────────${NC}"
echo ""
echo -e "  ${PURPLE}claude${NC}     Anthropic Claude Code ${GRAY}(most capable)${NC}"
echo -e "  ${PURPLE}aider${NC}      AI pair programming for config editing"
echo -e "  ${PURPLE}llm${NC}        Multi-provider CLI ${GRAY}(OpenAI, Anthropic, etc.)${NC}"
echo -e "  ${PURPLE}ollama${NC}     Run local AI models ${GRAY}(offline capable)${NC}"
echo ""

# Recovery tools section
echo -e "${WHITE}${BOLD}  Recovery Tools${NC}"
echo -e "${GRAY}  ────────────────────────────────────────────────────────────────────${NC}"
echo ""
echo -e "  ${GREEN}gparted${NC}    Partition editor        ${GREEN}testdisk${NC}   Partition recovery"
echo -e "  ${GREEN}ddrescue${NC}   Failing disk rescue     ${GREEN}photorec${NC}   File recovery"
echo -e "  ${GREEN}fsck.*${NC}     Filesystem repair       ${GREEN}chntpw${NC}     Windows passwords"
echo ""

echo -e "${TEAL}${BL_CORNER}$(printf '%0.s─' {1..72})${BR_CORNER}${NC}"
echo ""

# System status section
echo -e "${WHITE}${BOLD}  System Status${NC}"
echo ""

# Memory
mem_total=$(free -h | awk '/^Mem:/ {print $2}')
mem_avail=$(free -h | awk '/^Mem:/ {print $7}')
echo -e "  ${GRAY}Memory${NC}    ${GREEN}$mem_avail${NC} available ${GRAY}/ $mem_total total${NC}"

# Disks
disk_count=$(lsblk -d -n -o NAME | grep -cE '^(sd|nvme|vd|mmcblk)')
echo -e "  ${GRAY}Disks${NC}     ${GREEN}$disk_count${NC} storage device(s) detected"

# Network
if ip route | grep -q default; then
    ip_addr=$(ip route get 1.1.1.1 2>/dev/null | awk '{print $7; exit}')
    echo -e "  ${GRAY}Network${NC}   ${GREEN}Connected${NC} ${GRAY}($ip_addr)${NC}"
else
    echo -e "  ${GRAY}Network${NC}   ${YELLOW}Offline${NC} ${GRAY}- run nm-connection-editor${NC}"
fi

echo ""

# Claude setup prompt
echo -e "${TEAL}${TL_CORNER}$(printf '%0.s─' {1..72})${TR_CORNER}${NC}"
echo -e "${TEAL}${V_LINE}${NC}  ${WHITE}${BOLD}Claude Code Setup${NC}                                                   ${TEAL}${V_LINE}${NC}"
echo -e "${TEAL}${BL_CORNER}$(printf '%0.s─' {1..72})${BR_CORNER}${NC}"
echo ""
echo -e "  ${PURPLE}Claude Max/Pro:${NC}  Run ${WHITE}claude-login${NC} ${GRAY}(opens browser for OAuth)${NC}"
echo -e "  ${PURPLE}API Key:${NC}         ${WHITE}export ANTHROPIC_API_KEY='sk-ant-...'${NC}"
echo ""
echo -e "  ${GRAY}Get Claude Max: ${BLUE}https://claude.ai/upgrade${NC}"
echo -e "  ${GRAY}Get API Key:    ${BLUE}https://console.anthropic.com${NC}"
echo ""
echo -e "${GRAY}──────────────────────────────────────────────────────────────────────────${NC}"
echo ""
echo -e "  Type ${TEAL}ai-repair${NC} to start AI-assisted repair"
echo ""
